

<nav
  #nav
  *ngIf="settingValue$ | async as setting"
  [style]="setting.navHeight"
  class="navbar sticky-top navbar-expand-lg navbar-light bg-white shadow-sm"
>
  <div class="container-fluid">
    <!-- Mobile navigation bar button -->
    <div class="nav-container" *ngIf="setting.deviceType != 'desktop'">
      <button
        class="navbar-toggler p-1"
        type="button"
        [class]="{
          'bg-light': !collapseCategory
        }"
        (click)="categoryWindowToggle()"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
    </div>

    <!-- Brand logo (both mobile and desktop) -->
    <div
      class="nav-container d-flex flex-fill justify-content-center justify-content-lg-start d-inline-block"
    >
      <h2 class="my-0 py-0 nav-brand f font-brand text-uppercase text-accent" href="#">
        THYME
      </h2>
      <!-- Desktop navigation -->
      <ul class="navbar-nav" *ngIf="setting.deviceType == 'desktop'">
        <li
          class="nav-item ml-lg-3 cs-pointer"
          (mouseleave)="setCollapseCategory(true)"
          (mouseenter)="selectCategoryGroup(-1)"
        >
          <a class="nav-link text-uppercase" aria-current="page" routerLink="/"
            >Home</a
          >
        </li>

        <li
          class="nav-item cs-pointer"
          *ngFor="let item of categoryGroups; let i = index"
        >
          <a
            class="nav-link text-uppercase"
            [class]="{
              'bg-light': selectedCategoryGroup.gender == item.gender
            }"
            (mouseenter)="setCollapseCategory(false)"
            (mouseenter)="selectCategoryGroup(i)"
            >{{ item.genderTitle }}</a
          >
        </li>

        <li
          class="nav-item cs-pointer"
          (mouseleave)="setCollapseCategory(true)"
          (mouseenter)="selectCategoryGroup(-1)"
          routerLink="/sale-off"
        >
          <a class="nav-link text-uppercase text-danger">Sale off</a>
        </li>
        <li
          class="nav-item cs-pointer"
          routerLink="/news"
          (mouseleave)="setCollapseCategory(true)"
          (mouseenter)="selectCategoryGroup(-1)"
        >
          <a class="nav-link text-uppercase">Blogs</a>
        </li>
      </ul>
    </div>

    <!-- Right navigation icon (both mobile and desktop) -->
    <div class="d-flex d-inline-block nav-container justify-content-end">
      <button class="btn nav-btn d-lg-none" (click)="searchWindowToggle()">
        <img
          class="nav-icon-mobile"
          src="../../../assets/search.svg"
          alt="search"
        />
      </button>
      <button
        class="btn position-relative nav-btn cart-btn d-lg-none"
        (click)="cartWindowToggle()"
      >
        <img
          class="nav-icon-mobile"
          src="../../../assets/cart.svg"
          alt="cart"
        />
        <span
          *ngIf="cartService.currentCarts$ | async as cartItemList"
          class="position-absolute text-light translate-middle badge p-1 bg-accent"
        >
          {{ cartItemList.totalItem }}
        </span>
      </button>
    </div>

    <div class="d-none d-lg-block">
      <div class="d-flex flex-fill justify-content-lg-end">
        <div
          class="mr-2 desktop-search-bar-container"
          *ngIf="!collapseSearchBar && setting.deviceType == 'desktop'"
          [@fadeInAndOut]
        >
          <div class="form-group w-100 mb-0 position-relative">
            <input
              type="text"
              class="form-control"
              [(ngModel)]="searchQuery"
              (ngModelChange)="updateAction()"
              (keyup.enter)="showSearchResult()"
              #search
            />
            <p
              class="text-muted position-absolute my-auto mr-2 py-2 cs-pointer top-0 end-0"
              *ngIf="action == 'search'; else clear"
              aria-hidden="true"
              (click)="showSearchResult()"
            >
              Search
            </p>
            <ng-template #clear>
              <p
                class="text-muted position-absolute my-auto mr-2 py-2 cs-pointer top-0 end-0"
                aria-hidden="true"
                (click)="clearSearchQuery()"
              >
                Clear
              </p>
            </ng-template>
          </div>
        </div>
        <button
          *ngIf="collapseSearchBar && setting.deviceType == 'desktop'"
          class="btn nav-btn position-relative p-2"
          (click)="searchWindowToggle()"
        >
          <img class="nav-icon" src="../../../assets/search.svg" />
        </button>

        <button
          class="btn nav-btn position-relative py-2 pl-2 cart-btn"
          (click)="cartWindowToggle()"
        >
          <img class="nav-icon" src="../../../assets/cart.svg" alt="cart" />
          <span
            *ngIf="cartService.currentCarts$ | async as cartItemList"
            class="position-absolute text-light translate-middle badge p-1 bg-danger"
          >
            {{ cartItemList.totalItem }}
          </span>
        </button>
        <button
          class="btn nav-btn p-2"
          *ngIf="user"
          (click)="viewAccount('favorites')"
        >
          <img
            class="nav-icon"
            src="../../../assets/heart.svg"
            alt="favorites"
          />
        </button>
        <div class="dropdown" dropdown *ngIf="user">
          <button
            class="btn nav-btn p-2"
            dropdownToggle
            (click)="collapseAll()"
          >
            <img class="nav-icon" src="../../../assets/user.svg" alt="user" />
          </button>
          <div class="dropdown-menu dropdown-menu-end mt-3" *dropdownMenu>
            <a (click)="viewAccount('information')" class="dropdown-item"
              >My account</a
            >
            <a (click)="viewAccount('orders')" class="dropdown-item"
              >My orders</a
            >
            <a (click)="viewAccount('payment')" class="dropdown-item"
              >Payment information</a
            >
            <a (click)="logout()" class="dropdown-item">Log out</a>
          </div>
        </div>

        <a
          class="text-dark p-2 text-uppercase"
          *ngIf="!user"
          routerLink="/login"
          >Login</a
        >

        <a
          class="text-dark p-2 text-uppercase"
          *ngIf="!user"
          routerLink="/register"
          >Register</a
        >
      </div>
    </div>
  </div>

  <!-- Search bar -->
  <div
    *ngIf="!collapseSearchWindow"
    [style]="setting.navMargin"
    [@slideTopToBottom]
    class="bg-white search-bar position-absolute shadow-sm sticky-top"
  >
    <app-search-bar [@fade]></app-search-bar>
  </div>
  <!-- Cart -->
  <div
    [style]="setting.navMargin"
    *ngIf="!collapseCartWindow"
    [@slideRightToLeft]
    class="bg-transparent position-absolute cart shadow-sm sticky-top"
  >
    <app-cart
      (hideCart)="cartWindowToggle()"
      (goToCheckout)="cartCheckoutToggle()"
    ></app-cart>
  </div>

  <!-- Checkout -->
  <div
    [style]="setting.navMargin"
    *ngIf="!collapseCheckoutWindow"
    [@slideRightToLeft]
    class="bg-transparent position-absolute checkout shadow-sm sticky-top"
  >
    <app-check-out
      (hideCheckout)="checkOutWindowToggle()"
      (backToCart)="cartCheckoutToggle()"
    ></app-check-out>
  </div>

  <!-- Mobile & tablet navigation menu -->
  <div *ngIf="setting.deviceType != 'desktop'">
    <div
      [style]="setting.navMargin"
      *ngIf="!collapseCategory"
      [@slideLeftToRight]
      class="bg-white position-absolute mobile-category shadow-sm sticky-top px-0"
      [class]="
      {
        'col-6': setting.deviceType == 'tablet',
        'col-12': setting.deviceType == 'mobile'
      }"
    >
      <app-navigation-bar-mobile
        (hideCheckout)="checkOutWindowToggle()"
        (backToCart)="cartCheckoutToggle()"
      ></app-navigation-bar-mobile>
    </div>
  </div>

  <!-- Desktop category  -->
  <div *ngIf="setting.deviceType == 'desktop'">
    <div
      [style]="setting.navMargin"
      (mouseleave)="setCollapseCategory(true)"
      class="bg-white position-absolute shadow-sm sticky-top category-window"
      *ngIf="
        !collapseCategory &&
        selectedCategoryGroup &&
        selectedCategoryGroup.gender >= 0
      "
      [@slideTopToBottom]
    >
      <div class="p-2">
        <div class="row category-list-container">
          <div
            class="col-md-6 col-lg-4 col-xl-3"
            *ngFor="let category of selectedCategoryGroup.categories"
          >
            <div
              class="p-3 cs-pointer category-name"
              (click)="
                viewCategory(
                  category.categoryName,
                  category.slug,
                  selectedCategoryGroup.gender
                )
              "
            >
              <h4 class="m-0 p-0">
                {{ category.categoryName }}
              </h4>
            </div>
            <hr />
            <ul class="list-group my-1">
              <li
                class="list-group-item bg-transparent border-0 cs-pointer sub-category-name"
                *ngFor="let subCategory of category.subCategories"
                (click)="
                  viewCategory(
                    subCategory.categoryName,
                    subCategory.slug,
                    selectedCategoryGroup.gender
                  )
                "
              >
                <a class="text-dark">{{ subCategory.categoryName }}</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</nav>
