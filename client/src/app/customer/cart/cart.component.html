<div class="container-fluid p-0 m-0">
  <div
    class="row g-0 p-0 m-0 w-100 justify-content-lg-end"
    *ngIf="cartService.currentCarts$ | async as cartItemList"
  >
    <!-- Cart items list -->
    <div class="col-12 col-md-8 col-lg-7 bg-light p-0">
      <div class="cart-detail p-4 p-md-5">
        <a class="text-muted" (click)="closeCart()">
          <i class="fa fa-arrow-left" aria-hidden="true"></i>&nbsp;&nbsp;Back to
          store
        </a>
        <h2 class="mt-4">My cart</h2>
        <!-- Cart item table for desktop device -->
        <div
          class="table-responsive p-3 d-none d-md-block"
          *ngIf="cartItemList.cartItems.length > 0; else cartEmpty"
        >
          <table class="table table-borderless align-middle">
            <thead class="">
              <!-- Cart item table header -->
              <tr>
                <th class="text-muted">Items</th>
                <th class="text-muted">Price</th>
                <th class="text-muted text-center">Quantity</th>
              </tr>
            </thead>
            <tbody>
              <ng-container
                *ngFor="let cartItem of cartItemList.cartItems; let i = index"
              >
                <tr class="cart-item-row">
                  <td class="cart-item-detail">
                    <div class="row">
                      <!-- Item image on desktop -->
                      <div class="col-6 col-md-4">
                        <div class="rect-img-container pr-lg-3">
                          <img
                            class="rect-img"
                            src="{{ cartItem.imageUrl }}"
                            alt=""
                          />
                        </div>
                      </div>
                      <!-- Item detail (name, size, color) on desktop -->
                      <div class="col-6 col-md-8 my-auto va-middle">
                        <h5
                          class="p-0 m-0 text-dark fw-bold cs-pointer"
                          (click)="viewProduct(cartItem)"
                        >
                          {{ cartItem.productName }}
                        </h5>
                        <p class="m-0 p-0">
                          Color:&nbsp;{{ cartItem.colorName }}
                        </p>
                        <p class="m-0 p-0">
                          Size:&nbsp;{{ cartItem.sizeName }}
                        </p>
                        <!-- Item action on desktop -->
                        <div class="d-flex flex-md-column flex-lg-row">
                          <a
                            class="text-muted cs-pointer mr-3"
                            (click)="deleteCartItem(cartItem)"
                            >Delete</a
                          >
                          <a
                            class="text-muted cs-pointer mr-3"
                            (click)="likeProduct(cartItem)"
                            >Add to favorite</a
                          >
                        </div>
                      </div>
                    </div>
                  </td>
                  <td>
                    <p class="m-0 p-0">
                      {{ cartItem.price | currency }}
                    </p>
                  </td>
                  
                  <!-- Item quantity on desktop -->
                  <td class="text-center cart-item-quantity">
                    <div class="d-flex d-inline-block justify-content-center">
                      <button
                        #decreaseButton
                        class="btn btn-light border-top-right-0 border-bottom-right-0"
                        (click)="decreaseQuantity(cartItem)"
                        type="button"
                        id="button-addon1"
                      >
                        -
                      </button>
                      <input
                        type="number"
                        min="0"
                        [value]="cartItem.quantity"
                        class="form-control text-center quantity bg-light border-0"
                      />
                      <button
                        #increaseButton
                        class="btn btn-light border-top-left-0 border-bottom-left-0"
                        (click)="increaseQuantity(cartItem)"
                        type="button"
                        id="button-addon2"
                      >
                        +
                      </button>
                    </div>
                  </td>
                </tr>
              </ng-container>
            </tbody>
          </table>
        </div>

        <!-- Cart item list for mobile device -->
        <div class="p-3 d-md-none" *ngIf="cartItemList.cartItems.length > 0">
          <ng-container
            *ngFor="let cartItem of cartItemList.cartItems; let i = index"
          >
            <div class="row mb-5">
              <!-- Item image on mobile -->
              <div class="col-3 px-0">
                <div class="rect-img-container">
                  <img class="rect-img" src="{{ cartItem.imageUrl }}" alt="" />
                </div>
              </div>
              <!-- Item detail on mobile -->
              <div class="col-7 my-auto va-middle">
                <p
                  class="p-0 m-0 text-dark fw-bold"
                  (click)="viewProduct(cartItem)"
                >
                  {{ cartItem.productName }}&nbsp;-&nbsp;{{
                    cartItem.colorName
                  }}
                </p>
                <p class="m-0 p-0">Size:&nbsp;{{ cartItem.sizeName }}</p>
                <!-- Item quantity on mobile -->
                <div class="d-flex d-inline-block">
                  <button
                    #decreaseButton
                    class="btn btn-light border-top-right-0 border-bottom-right-0"
                    (click)="decreaseQuantity(cartItem)"
                    type="button"
                    id="button-addon1"
                  >
                    -
                  </button>
                  <input
                    type="number"
                    min="0"
                    [value]="cartItem.quantity"
                    class="form-control text-center quantity bg-light border-0"
                  />
                  <button
                    #increaseButton
                    class="btn btn-light border-top-left-0 border-bottom-left-0"
                    (click)="increaseQuantity(cartItem)"
                    type="button"
                    id="button-addon2"
                  >
                    +
                  </button>
                </div>
              </div>
              <!-- Item action on mobile -->
              <div class="col-2 my-auto text-center va-middle">
                <button class="btn btn-light">
                  <i class="fa fa-times" aria-hidden="true"></i>
                </button>
              </div>
            </div>
          </ng-container>
        </div>
        <!-- Display if client's cart is empty -->
        <ng-template #cartEmpty>
          <div class="p-5 h-100 w-100 text-center">
            <h5 class="text-muted">
              You have not added any item to your cart yet
            </h5>
          </div>
        </ng-template>
      </div>
    </div>
    <!-- Cart items summary -->
    <div class="col-12 col-md-4 col-lg-3 p-0">
      <div class="cart-summary bg-white d-flex flex-column p-4 p-md-5">
        <h4 class="mt-5">Summary</h4>
        <!-- Display summary -->
        <div class="d-flex mt-4">
          <div class="bd-highlight">Subtotal</div>
          <div class="flex-fill text-right fw-bold">
            {{ cartItemList.totalPrice | currency }}
          </div>
        </div>
        <div class="d-flex mt-2">
          <div class="bd-highlight">Discount</div>
          <div class="flex-fill text-right fw-bold">
            {{ discountAmount | currency }}
          </div>
        </div>
        <div class="d-flex mt-2">
          <div class="bd-highlight">Tax</div>
          <div class="flex-fill text-right fw-bold">
            {{
              ((cartItemList.totalPrice - discountAmount) * 10) / 100 | currency
            }}
          </div>
        </div>
        <!-- Promo code input -->
        <div class="mt-4">
          <p class="text-uppercase">enter promote code</p>
          <div
            class="input-group mb-3"
            *ngIf="!promoCodeApplied; else applyCode"
          >
            <input
              type="text"
              class="form-control promo-code"
              placeholder="Promote code"
              [(ngModel)]="promoCode"
              aria-describedby="button-addon2"
            />
            <button
              class="btn btn-light border-top-left-0 border-bottom-left-0"
              type="button"
              (click)="applyDiscountCode()"
            >
              Apply
            </button>
          </div>
          <!-- Promo code apply successfully -->
          <ng-template #applyCode>
            <div class="input-group mb-3">
              <input
                type="text"
                class="form-control"
                placeholder="{{ promoCode }}"
                disabled
              />
              <button
                class="btn btn-dark border-top-left-0 border-bottom-left-0"
                type="button"
                (click)="removeDiscountCode()"
              >
                Remove
              </button>
            </div>
          </ng-template>
        </div>
        <!-- Cart total -->
        <div class="mt-auto">
          <div class="d-flex">
            <div class="bd-highlight">Estimated total</div>
            <div class="flex-fill text-right fw-bold">
              {{
                cartItemList.totalPrice -
                  discountAmount +
                  ((cartItemList.totalPrice - discountAmount) * 10) / 100
                  | currency
              }}
            </div>
          </div>
          <button class="btn btn-dark w-100 mt-3 text-uppercase" [disabled]="cartItemList.cartItems.length <= 0">
            Checkout
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
